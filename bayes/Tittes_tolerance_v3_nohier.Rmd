---
title: "tolerance curves"
author: "Silas Tittes"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  pdf_document:
    fig_caption: yes
---



```{r, echo=FALSE, results='hide', message=FALSE}

#packages
library(rmarkdown)
library(knitr)
library(formatR)
library(xtable)
library(dplyr)
library(rstan)
library(ggplot2)
library(smoothmest)
rstan_options(auto_write = TRUE)
options(mc.cores = parallel::detectCores())

options(scipen=99) #avoid scientific notation when printing
opts_chunk$set(tidy=TRUE, tidy.opts=list(width.cutoff=70, message=FALSE, results='hide'))
options(bitmapType="cairo")

opar <- par()
opar$cin <- NULL
opar$cra <- NULL
opar$csi <- NULL
opar$cxy <- NULL
opar$din <- NULL
opar$page <- NULL
```


## Data prep
```{r}
setwd("~/Documents/Projects/toleranceCurves/bayes/")
source("tolerance_functions.R")
emery <- load_emery()
setwd("~/Documents/Projects/toleranceCurves/bayes/")
```


## The model
```{r}
dataList <- list(N = nrow(emery), 
		 x = emery$treat, 
		 y = emery$Inflor_biomass,
		 numSpp = length(unique(emery$sppint)),
		 sppint = emery$sppint
		)
```


Gamma scaled version -- best
```{r}
watch <- c("a", "b", "c","d", "e", "e1", "mu",
           "nu", "beta_0", "beta_1", "var_c")
stan.fit <- stan(file = "tolerance_zig_v3_nohier.stan",
                     data = dataList,
                 iter = 5000, chains = 4,
                 pars = watch,
                sample_file = "tolerance_zig_v3_nohier.samples",
                diagnostic_file = "tolerance_zig_v3_nohier.diag"
)
```


Normal model version -- meh
```{r, eval=FALSE}
watch <- c("a", "b", "c","d", "e", "e1")
stan.fit <- stan(file = "tolerance_zig_vNormal_nohier.stan",
                     data = dataList,
                 iter = 5000, chains = 4,
                 pars = watch,
                sample_file = "tolerance_zig_vNormal_nohier.samples",
                diagnostic_file = "tolerance_zig_vNormal_nohier.diag"
)
```
